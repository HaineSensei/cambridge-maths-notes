\subsection{?}
\begin{lemma}
    Let \( x \in \mathcal O_L \), where \( L \) is a number field.
    Then \( x \) is a unit in \( \mathcal O_L \) if and only if \( N_{L/\mathbb Q}(x) = \pm 1 \).
    We write \( \mathcal O_L^\star \) for the set of units of \( \mathcal O_L \).
\end{lemma}
\begin{proof}
    If \( x \) is a unit, then as the norm is multiplicative, \( N(x x^{-1}) = 1 \) so \( N(x)N(x^{-1}) = 1 \).
    So \( N(x) = \pm 1 \).
    Conversely, let \( \sigma_1, \dots, \sigma_n \colon L \to \mathbb C \) be the distinct field embeddings.
    Let \( L \subseteq \mathbb C \) be the containment given by \( \sigma_1 \).
    If \( x \in \mathcal O_L \), then \( N(x) = x\sigma_2(x) \dots \sigma_n(x) \).
    So if \( N(x) = \pm 1 \), we have \( \frac{1}{x} = \pm \prod_{i=2}^n \sigma_i(x) \).
    This is a product of algebraic integers, hence an algebraic integer.
    So \( x^{-1} \in \mathcal O_L \).
\end{proof}
Recall that if \( x \in \mathcal O_L \), it is irreducible if it does not factorise as \( ab \) where \( a, b \in \mathcal O_L \) not units.
If \( x = uy \) where \( u \) is a unit, we say \( x \) and \( y \) are associate.
Many number fields have rings of algebraic integers which are not unique factorisation domains.
\begin{example}
    Let \( L = \mathbb Q\qty(\sqrt{-5}) \).
    Here, \( \mathcal O_L = \mathbb Z\qty[\sqrt{-5}] \).
    Note that \( 3 \cdot 7 = \qty(1 + 2\sqrt{-5})\qty(1 - 2\sqrt{-5}) \), and \( N(3) = 9, N(7) = 49, N\qty(1 \pm \sqrt{-5}) = 21 \).
    These are not associates.
    We claim that \( 3, 7, 1 \pm 2 \sqrt{-5} \) are irreducible, so \( \mathcal O_L \) is not a unique factorisation domain.
    If this were not the case, \( 3 = \alpha \overline \alpha \), where \( \alpha = x + y\sqrt{-5} \), but \( N(3) = 9 = N(\alpha) N(\overline \alpha) = N(\alpha)^2 \) so \( N(\alpha) = x^2 + 5y^2 = \pm 3 \), but there are no integer solutions to this equation.
    All of the other factors are similarly irreducible.
\end{example}
\begin{remark}
    In any number field, one can factorise any \( \alpha \in \mathcal O_L \) into a product of irreducibles by induction on \( \abs{N(\alpha)} \), but this factorisation is not in general unique.
    An idea due to Kummer is to measure the failure of unique factorisation by studying ideals \( \mathfrak a \triangleleft \mathcal O_L \).
\end{remark}
If \( x_1, \dots, x_n \in \mathcal O_L \), we write \( \genset{x_1, \dots, x_n} \) for the ideal \( \sum x_i \mathcal O_L \) generated by the \( x_i \).
We will consider products of ideals, rather than products of elements.
\begin{definition}
    If \( \mathfrak a, \mathfrak b \triangleleft \mathcal O_L \), define \( \mathfrak a \mathfrak b = \qty{\sum a_i b_i \mid a_i \in \mathfrak a, b_i \in \mathfrak b} \).
\end{definition}
One can check that this is an ideal, and that products are associative.
\begin{example}
    \( \genset{x_1, \dots, x_n} \genset{y_1, \dots, y_m} = \genset{\qty{x_i y_j \mid 1 \leq i \leq n, 1 \leq j \leq n}} \).
    For instance, \( \genset{x}\genset{y} = \genset{xy} \), so the product of principal ideals is principal.
\end{example}
\begin{example}
    Consider \( \mathbb Z[\sqrt{5}] = \mathcal O_L \), and the ideals \( \mathfrak p_1 = (3, 1 + 2\sqrt{5}), \mathfrak p_2 = (3, 1-2\sqrt{5}) \).
    We obtain \( \mathfrak p_1 \mathfrak p_2 = (9, 3(1-2\sqrt{5}), 3(1+2\sqrt{5}), 21) = (3) \).
    So the ideal \( (3) \) factors as \( \mathfrak p_1 \mathfrak p_2 \) in \( \mathcal O_L \).
    Note that \( 37 = (1 + 2\sqrt{-5})(1 - 2\sqrt{-5}) \), so \( \mathbb Z[\sqrt{5}] \) is not a unique factorisation domain.
\end{example}
Recall that an ideal \( \mathfrak p \triangleleft R \) is \emph{prime} if \( \frak{R}{\mathfrak p} \) is an integral domain, so \( p \neq R \) and for all \( x, y \in R \), \( xy \in \mathfrak p \) implies \( x \in \mathfrak p \) or \( y \in \mathfrak p \).
In this course, we will also define that a prime ideal is nonzero.

\subsection{?}
\begin{lemma}
    If \( \mathfrak a \triangleleft \mathcal O_K \), it contains an integer, and moreover, \( \faktor{\mathcal O_K}{\mathfrak a} \) is a finite set.
\end{lemma}
\begin{proof}
    Let \( \alpha \in \mathfrak a, \alpha \neq 0 \).
    Let \( p_\alpha(x) = x^m + a_{m-1} x^{m-1} + \dots + a_0 \in \mathbb Z[x] \) be its minimal polynomial, and \( a_0 \neq 0 \).
    Then \( a_0 = -\alpha(\alpha^{n-1} + a_{n-1} \alpha^{n-1} + \dots + a_2 \alpha + a_1) \).
    But \( a_0 \in \mathbb Z \), \( \alpha \in \mathfrak a \), and the other factor lies in \( \mathcal O_K \).
    So \( a_0 \in \mathfrak a \) as \( \mathfrak a \) is an ideal.
    Hence \( a_0 \mathcal O_K \subseteq \mathfrak a \), so \( \faktor{\mathcal O_K}{a_0 \mathcal O_K} \) surjects onto \( \faktor{\mathcal O_K}{\mathfrak a} \).
    But for any integer \( d \), \( \faktor{\mathcal O_K}{d\mathcal O_K} = \faktor{\mathbb Z^n}{d\mathbb Z^n} = \qty(\faktor{\mathbb Z}{d\mathbb Z})^n \) is a finite set, so \( \faktor{\mathcal O_K}{\mathfrak a} \) is finite.
\end{proof}
\begin{corollary}
    \( \mathfrak a \simeq \mathbb Z^n \), as \( \mathcal O_K \simeq \mathbb Z^n \) and the quotient is finite.
\end{corollary}
Therefore, nonzero ideals in \( \mathcal O_K \) are isomorphic to \( \mathbb Z^n \) as abelian groups.
\begin{proposition}
    \begin{enumerate}
        \item \( \mathcal O_K \) is an integral domain.
        \item \( \mathcal O_K \) is a Noetherian ring.
        \item \( \mathcal O_K \) is \emph{integrally closed} in \( K \) (which is the field of fractions of \( \mathcal O_K \)): if \( x \in K \) is integral over \( \mathcal O_K \), it lies in \( \mathcal O_K \).
        \item Every (implicitly nonzero) prime ideal is maximal.
        We say that the \emph{Krull dimension} of \( \mathcal O_K \) is 1.
    \end{enumerate}
\end{proposition}
\begin{remark}
    A ring with these four properties is called a \emph{Dedekind domain}.
    Many of the results in this section hold for all Dedekind domains.
\end{remark}
\begin{proof}
    \emph{Part (i).}
    \( \mathcal O_K \subseteq K \), and \( K \) is a field.

    \emph{Part (ii).}
    We have shown that \( \mathcal O_K \simeq \mathbb Z^n \), where \( n = [K : \mathbb Q] \), so \( \mathcal O_K \) is finitely generated as an abelian group, so is certainly finitely generated as a ring.

    \emph{Part (iii).}
    \( \mathcal O_K \) is integral over \( \mathbb Z \) by definition, so if \( x \) is integral over \( \mathcal O_K \), it is integral over \( \mathbb Z \).
    So \( x \) is an algebraic integer, so lies in \( \mathcal O_K \).

    \emph{Part (iv).}
    If \( \mathfrak p \) is a prime ideal, then by the previous lemma \( \faktor{\mathcal O_K}{\mathfrak p} \) is finite and an integral domain, as \( \mathfrak p \) is prime.
    All finite integral domains are fields, hence \( \mathfrak p \) is maximal.
\end{proof}
\begin{example}
    Consider \( R = \mathbb C[X,Y] \).
    Then \( (x) \) is prime but not maximal, since \( (x) \subsetneq (x,y) \).
\end{example}
If \( \mathfrak a, \mathfrak b \) are ideals, we write \( \mathfrak a + \mathfrak b \) for the ideal \( \qty{x + y \mid x \in \mathfrak a, y \in \mathfrak b} \).

\subsection{Unique factorisation of ideals}
We aim to show that every ideal in \( \mathcal O_K \) factors uniquely as a product of prime ideals.
\begin{definition}
    \( \mathfrak b \) divides \( \mathfrak a \) if there exists an ideal \( \mathfrak c \) such that \( \mathfrak a = \mathfrak b \mathfrak c \).
    We write \( \mathfrak b \mid \mathfrak a \).
\end{definition}
\begin{example}
    \( (5, 1 + 2\sqrt{5}) \mid (3) \) in \( \mathcal O_{\mathbb Q(\sqrt{-5})} \).
    \( 3\mathbb Z \mid 6\mathbb Z \) as \( 3\mathbb Z \cdot 2\mathbb Z = 6\mathbb Z \).
\end{example}
Note that \( \mathfrak b \mathfrak c \subseteq \mathfrak b \), as \( \mathfrak b \) is an ideal.
So if \( \mathfrak b \mid \mathfrak a \), then \( \mathfrak a \subseteq \mathfrak b \).
We will show the converse, that \( \mathfrak a \subseteq \mathfrak b \) implies \( \mathfrak b \mid \mathfrak a \).
This allows us to prove results about division by using containment.
Note that prime ideals are maximal, which allows us to use the containment relation.
\begin{lemma}
    Let \( \mathfrak p \) be a prime ideal in a ring \( R \), and let \( \mathfrak a, \mathfrak b \triangleleft R \) be ideals.
    Then if \( \mathfrak a \mathfrak b \subseteq \mathfrak p \), either \( \mathfrak a \subseteq \mathfrak p \) or \( \mathfrak b \subseteq \mathfrak p \).
\end{lemma}
\begin{proof}
    Otherwise, there exists \( a \in \mathfrak a \setminus \mathfrak p \) and \( b \in \mathfrak b \setminus \mathfrak p \), with \( ab \in \mathfrak p \).
    But \( \mathfrak p \) is prime giving a contradiction.
\end{proof}
\begin{lemma}
    Let \( \mathfrak a \trianglelefteq \mathcal O_K \) be a nonzero ideal.
    Then \( \mathfrak a \) contains a product of prime ideals.
\end{lemma}
\begin{proof}
    Otherwise, as \( \mathcal O_K \) is Noetherian, there exists a ideal \( \mathfrak a \) which is maximal with this property.
    As prime ideals are maximal, \( \mathfrak a \) is not prime.
    So there exists \( x, y \in \mathcal O_K \) with \( x, y \not\in \mathfrak a \) but \( xy \in \mathfrak a \).
    So \( \mathfrak a \subsetneq \mathfrak a + (x) \).
    But then, \( \mathfrak a + (x) \) contains a product of prime ideals \( \mathfrak p_1, \dots, \mathfrak p_r \) with \( \mathfrak p_1\dots \mathfrak p_r \subseteq \mathfrak a + (x) \).
    Similarly,  there exist prime ideals \( \mathfrak q_1, \dots \mathfrak q_s \) such that \( \mathfrak q_1 \dots\mathfrak q_s \subseteq \mathfrak a + (y) \).
    Then,
    \[ \mathfrak p_1\dots \mathfrak p_r\mathfrak q_1 \dots\mathfrak q_s \subseteq (\mathfrak a + (x))(\mathfrak a + (y)) = \mathfrak a + (xy) \]
    But \( xy \in \mathfrak a \), giving a contradiction.
\end{proof}
The main proof will use the idea that we can formally introduce the group of fractions of the commutative monoid of ideals.
The object \( \qty{y \in K \mid y\mathfrak a \in \subseteq \mathcal O_K} \) will represent the inverse of \( \mathfrak a \).
\begin{lemma}
    \begin{enumerate}
        \item Let \( 0 \neq \mathfrak a \trianglelefteq \mathcal O_K \) be an ideal.
        If \( x \in K \) has the property that \( x\mathfrak a \subseteq \mathfrak a \), then \( x \in \mathcal O_K \).
        \item Let \( 0 \neq \mathfrak a \triangleleft \mathcal O_K \) be a proper ideal.
        Then, \( \mathcal O_K \subseteq \qty{y \in K \mid y\mathfrak a \in \subseteq \mathcal O_K} \) contains elements which are not in \( \mathcal O_K \).
        Equivalently, \( \faktor{\qty{y \in K \mid y\mathfrak a \in \subseteq \mathcal O_K}}{\mathcal O_K} \neq \qty{1} \) as abelian groups.
    \end{enumerate}
\end{lemma}
\begin{example}
    Let \( \mathcal O_K = \mathbb Z \) and \( \mathfrak a = 3\mathbb Z \).
    Then, part (i) shows that if \( \frac{a}{b} \cdot 3 \in \mathbb 3\mathbb Z \), then \( \frac{a}{b} \in \mathbb Z \).
    Part (ii) shows that if \( \frac{a}{b} \cdot 3 \in \mathbb Z \) then \( \frac{a}{b} \in \frac{1}{3}\mathbb Z \); for instance, if \( \frac{a}{b} = \frac{1}{3} \), we have \( \faktor{\frac{1}{3}\mathbb Z}{\mathbb Z} = \faktor{\mathbb Z}{3\mathbb Z} \neq \qty{1} \).
\end{example}
\begin{proof}
    \emph{Part (i).}
    \( \mathfrak a \subseteq \mathcal O_K \) is finitely generated as an abelian group, as it is isomorphic to \( \mathbb Z^n \).
    Let \( \alpha_1, \dots, \alpha_n \) be a \( \mathbb Z \)-basis of \( \mathfrak a \).
    Consider \( m_x \colon \mathfrak a \to \mathfrak a \) given by multiplication by \( x \in K \).
    We write \( x \alpha_i = \sum a_{ij} \alpha_j \), where by assumption, \( a_{ij} \) are integers.
    Hence,
    \[ (xI - A) \begin{pmatrix}
        \alpha_1 \\
        \vdots \\
        \alpha_n
    \end{pmatrix} = 0 \]
    where \( A = (a_{ij}) \).
    So \( \det(xI - A) = 0 \), so \( x \) is integral over \( \mathbb Z \); that is, \( x \in \mathcal O_K \).

    \emph{Part (ii).}
    If this holds for \( \mathfrak a \), it certainly holds for all prime ideals \( \mathfrak a' \subseteq \mathfrak a \).
    So without loss of generality, let \( \mathfrak a \) be maximal, so \( \mathfrak a = \mathfrak p \) is a prime ideal.
    Let \( \alpha \in \mathfrak p \) be nonzero.
    By the previous lemma, there exist prime ideals \( \mathfrak p_1, \dots, \mathfrak p_r \) such that \( \mathfrak p_1 \dots \mathfrak p_r \subseteq (\alpha) \subseteq \mathfrak p \).
    Suppose that \( r \) is minimal.
    By the first lemma in this subsection, there exists \( i \) such that \( \mathfrak p_i \subseteq \mathfrak p \), and without loss of generality \( i = 1 \).
    So \( \mathfrak p_1 \subseteq \mathfrak p \).
    But \( \mathfrak p_1 \) is maximal, so \( \mathfrak p_1 = \mathfrak p \).

    Since \( r \) is minimal, \( \mathfrak p_2 \dots \mathfrak p_r \subsetneq (\alpha) \).
    Fix \( \beta \in \mathfrak p_2 \dots \mathfrak p_r \not\subseteq (\alpha) \).
    Then \( \beta \mathfrak p \subseteq \mathfrak p (\mathfrak p_2 \dots \mathfrak p_r) \subseteq (\alpha) \), but \( \beta \not\subseteq (\alpha) \).
    So, dividing by \( \alpha \), we obtain \( \frac{\beta}{\alpha} \mathfrak p \subseteq (1) = \mathcal O_K \), but \( \frac{\beta}{\alpha} \not\in \mathcal O_K \).
\end{proof}
\begin{definition}
    A \emph{fractional ideal} is an \( \mathcal O_K \)-module \( X \) such that \( X \subseteq K \) and \( X \) is finitely generated.
\end{definition}
\( X = \qty{x \in K \mid x\mathfrak a \subseteq \mathcal O_K} \) is an \( \mathcal O_K \)-module.
If \( \alpha \in \mathfrak a \setminus \qty{0} \), then \( \alpha X \subseteq \mathcal O_K = \mathbb Z^n \) where \( n = [K:\mathbb Q] \).
Multiplication by \( \alpha \) is an isomorphism \( X \to \alpha X \), and submodules of \( \mathbb Z^n \) are finitely generated abelian groups, so \( X \) is finitely generated as an abelian group, hence as an \( \mathcal O_K \)-module.
Hence \( X \) is a fractional ideal.
\begin{lemma}
    \( q \subseteq K \) is a fractional ideal if and only if there exists a nonzero constant \( c \in K \) such that \( cq \) is an ideal in \( \mathcal O_K \).
\end{lemma}
\begin{proof}
    Suppose \( cq \) is an ideal.
    Then \( q \subseteq K \), and multiplication by \( c \) is an isomorphism \( q \to cq \) as \( \mathcal O_K \)-modules, so it is finitely generated as \( q \) is.

    Suppose \( q \) is a fractional ideal.
    Then, \( x_1, \dots, x_r \) generate \( q \) as an \( \mathcal O_K \)-module.
    But \( x_i \in K \) so \( x_i = \frac{y_i}{n_i} \) where \( y_i \in \mathcal O_K \), \( n_i \in \mathbb Z \).
    Let \( c \) be the least common multiple of the \( n_i \), and then \( cq \subseteq \mathcal O_K \), and is a submodule of \( \mathcal O_K \), and hence is an ideal.
\end{proof}
\begin{corollary}
    \( q \) is isomorphic to \( \mathbb Z^n \) as an abelian group.
\end{corollary}
\begin{proof}
    We have shown that all nonzero ideals in \( \mathcal O_K \) are isomorphic to \( \mathbb Z^n \) as abelian groups, where \( n = [K:\mathbb Q] \), and multiplication by \( c \) is an isomorphism \( q \to cq \).
\end{proof}
Ideals are sometimes called \emph{integral ideals} to distinguish from fractional ideals.
One can define multiplication of fractional ideals in the same way that we defined integral ideals.
\begin{definition}
    A fractional ideal \( q \) is \emph{invertible} if there exists a fractional ideal \( r \) such that \( qr = (1) = \mathcal O_K \).
\end{definition}
\begin{proposition}
    Every nonzero fractional ideal \( \mathfrak q \) is invertible, and its inverse is \( \mathfrak q^{-1} = \qty{x \in K \mid x\mathfrak q \subseteq \mathcal O_K} \).
\end{proposition}
% TODO: q |-> \mathfrak q, r |-> \mathfrak r
\begin{remark}
    \( \mathfrak q = \frac{1}{n} \mathfrak a, \mathfrak r = \frac{1}{m} \mathfrak b \) where \( \mathfrak a, \mathfrak b \) are integral ideals in \( \mathcal O_K \), and \( n, m \in K^\star \).
    Then \( \mathfrak q\mathfrak r = 1 \) if and only if \( \mathfrak a \mathfrak b = (nm) \).
    Therefore, the proposition is equivalent to the statement that for every \( \mathfrak a \trianglelefteq \mathcal O_K \), there exists an ideal \( \mathfrak b \trianglelefteq \mathcal O_K \) such that \( \mathfrak a \mathfrak b \) is principal.
\end{remark}
\begin{proof}
    \( \mathfrak q \) is invertible if and only if \( \mathfrak a \) is invertible, where \( n\mathfrak q = \mathfrak a \) as above.
    So, without loss of generality, let \( \mathfrak q \) be an integral ideal.
    If the proposition is false, there exists some integral ideal in \( \mathcal O_K \).
    As \( \mathcal O_K \) is Noetherian, there exists a maximal such ideal \( \mathfrak a \neq \mathcal O_K \).
    So every ideal \( \mathfrak a' \supsetneq \mathfrak a \) is invertible.
    Let \( \mathfrak b = \qty{x \in K \mid x\mathfrak a \subseteq \mathcal O_K} \), which is a fractional ideal.
    \( \mathcal O_K \subseteq \mathfrak b \) hence \( \mathfrak a \subseteq \mathfrak a \mathfrak b \).
    If \( \mathfrak a = \mathfrak a \mathfrak b \), then part (i) of a previous lemma implies that \( \mathfrak b \subseteq \mathcal O_K \).
    Part (ii) of the same lemma implies \( \mathfrak b \setminus \mathcal O_K \neq \varnothing \), which is a contradiction.
    So \( \mathfrak a \subsetneq \mathfrak a \mathfrak b \subsetneq \mathcal O_K \).
    Then \( \mathfrak a \mathfrak b \) is invertible by assumption, so \( \mathfrak a \) is invertible, giving a contradiction.
    Finally, \( \mathfrak q^{-1} \subseteq \qty{x \in K \mid x\mathfrak q \subseteq \mathcal O_K} = X \), so \( \mathfrak q \mathfrak q^{-1} = \mathcal O_K \subseteq \mathfrak q X \subseteq \mathcal O_K \), so we have equality: \( \mathfrak q^{-1} = X \).
\end{proof}
\begin{corollary}
    Let \( \mathfrak a, \mathfrak b, \mathfrak c \triangleleft \mathcal O_K \) be integral ideals, and let \( \mathfrak c \neq (0) \).
    Then,
    \begin{enumerate}
        \item \( \mathfrak b \subseteq \mathfrak a \iff \mathfrak b \mathfrak c \subseteq \mathfrak a \mathfrak c \);
        \item \( \mathfrak a \mid \mathfrak b \iff \mathfrak a \mathfrak c \mid \mathfrak b \mathfrak c \);
        \item \( \mathfrak a \mid \mathfrak b \iff \mathfrak b \subseteq \mathfrak a \).
    \end{enumerate}
\end{corollary}
\begin{proof}
    The forward direction of parts (i) and (ii) are clear; the backward direction follows from multiplication by \( c^{-1} \).
    The forward direction of part (iii) has already been seen.
    Now, suppose \( \mathfrak b \subseteq \mathfrak a \).
    By the proposition above, there exists \( \mathfrak c \) such that \( \mathfrak a \mathfrak c = (\alpha) \) is principal.
    Then, \( \mathfrak b \subseteq \mathfrak a \) if and only if \( \mathfrak b \mathfrak c \subseteq (\alpha) \) by part (i).
    \( \mathfrak a \mid \mathfrak b \) if and only if \( (\alpha) \mid \mathfrak b \mathfrak c \) by part (ii).
    But if \( \mathfrak b \mathfrak c \) is generated by \( \beta_1, \dots, \beta_r \), \( \mathfrak b \mathfrak c \subseteq (\alpha) \) means that each \( \beta_i \) is divisible by \( \alpha \).
    More precisely, \( \beta_i = \beta_i' \alpha \) for some \( \beta_i' \in \mathcal O_K \).
    So \( (\beta_1, \dots, \beta_r) = (\beta_1', \dots, \beta_r') (\alpha) \) proving part (iii).
\end{proof}
\begin{remark}
    Part (iii) is straightforward if \( \mathfrak a \) is principal, and invertibility via fractional ideals allows us to reduce to this case.
\end{remark}
\begin{theorem}
    Let \( \mathfrak a \triangleleft \mathcal O_K \) be a nonzero ideal.
    Then \( \mathfrak a \) can be written uniquely as a product of prime ideals.
\end{theorem}
\begin{proof}
    If \( \mathfrak a \) is not prime, it is not maximal.
    Let \( \mathfrak b \supsetneq \mathfrak a \) be an ideal in \( \mathcal O_K \).
    Then \( \mathfrak a = \mathfrak b \mathfrak c \) for some ideal \( \mathfrak c \) containing \( \mathfrak a \) by part (iii) of the previous corollary.
    We continue factoring in this way.
    As the ring is Noetherian, this process will always terminate, as we produce an ascending chain.

    For uniqueness, we have shown that \( \mathfrak p \mid \mathfrak a \mathfrak b \) implies \( \mathfrak p \mid \mathfrak a \) or \( \mathfrak p \mid \mathfrak b \).
    So if \( \mathfrak p_1 \dots \mathfrak p_r = \mathfrak q_1 \dots \mathfrak q_s \) with \( \mathfrak p_i, \mathfrak q_i \) prime, we have \( \mathfrak p_1 \mid \mathfrak q_i \) for some \( i \).
    So let \( i = 1 \) without loss of generality, so \( \mathfrak q_1 \subseteq \mathfrak p_1 \).
    But \( \mathfrak q_1 \) is maximal, so \( \mathfrak q_1 = \mathfrak p_1 \).
    Multiply by \( \mathfrak p_1^{-1} \) to obtain \( \mathfrak p_2 \dots \mathfrak p_r = \mathfrak q_2 \dots \mathfrak q_s \), then by induction, the \( \mathfrak p_i \) and \( \mathfrak q_i \) match.
\end{proof}
\begin{corollary}
    The nonzero fractional ideals form a group \( I_K \) under multiplication.
    \( I_K \) is the free abelian group generated by the prime ideals \( \mathfrak p \triangleleft \mathcal O_K \).
    In other words, any \( \mathfrak q \in I_K \) can be written uniquely as a product of prime ideals and their inverses.
    \( \mathfrak q \in I_K \) is an integral ideal if and only if all of the exponents are nonnegative.
\end{corollary}
\begin{proof}
    Follows from the previous theorem after writing \( \mathfrak q = \mathfrak a \mathfrak b^{-1} \) where \( \mathfrak a, \mathfrak b \trianglelefteq \mathcal O_K \).
\end{proof}

\subsection{Class group}
Observe that we have a map \( K^\star \to I_K \) mapping \( x \) to the principal ideal \( (x) \).
This map is a group homomorphism, as \( \alpha\beta \mapsto (\alpha)(\beta) \).
Its kernel is the set of \( \alpha \in K^\star \) such that \( (\alpha) = (1) = \mathcal O_K \), which is the set \( \mathcal O_K^\star \) of invertible elements of \( \mathcal O_K \).
The image is the set of principal ideals \( P_K \).
\begin{definition}
    The \emph{class group} of a number field \( K \) is \( \mathrm{Cl}_K = \faktor{I_K}{P_K} \), the cokernel of the map \( K^\star \to I_K \).
\end{definition}
If \( \mathfrak a \in I_K \), we write \( [\mathfrak a] \) for its equivalence class in the class group, so \( [\mathfrak a] = [\mathfrak b] \) if and only if there exists \( \gamma \in K^\star \) such that \( \gamma \mathfrak a = \mathfrak b \).
\begin{theorem}
    The following are equivalent.
    \begin{enumerate}
        \item \( \mathcal O_K \) is a principal ideal domain;
        \item \( \mathcal O_K \) is a unique factorisation domain;
        \item \( \mathrm{Cl}_K \) is trivial.
    \end{enumerate}
\end{theorem}
\begin{proof}
    (i) holds if and only if (iii) holds by definition.
    (i) implies (ii) is a general fact from IB Groups, Rings and Modules.
    The proof that (ii) implies (i) remains.
    Let \( \mathfrak p \) be a prime ideal in \( \mathcal O_K \), and \( x \in \mathfrak p \) a nonzero element of this ideal.
    We can factorise \( x \) into irreducibles \( x = \alpha_1 \dots \alpha_r \) uniquely by assumption.
    As \( \mathfrak p \) is prime, some \( \alpha_i \) lies in \( \mathfrak p \).
    Then \( (\alpha_i) \subseteq \mathfrak p \), and as \( \mathcal O_K \) is a unique factorisation domain and \( \alpha_i \) is irreducible, \( (\alpha_i) \) is prime.
    But prime ideals are maximal, so \( (\alpha_i) = \mathfrak p \) as required.
\end{proof}
Hence, the following sequence is exact.
% https://q.uiver.app/?q=WzAsNixbMCwwLCIxIl0sWzEsMCwiXFxtYXRoY2FsIE9fS15cXHN0YXIiXSxbMiwwLCJLXlxcc3RhciJdLFszLDAsIklfSyJdLFs0LDAsIlxcbWF0aHJte0NsfV9LIl0sWzUsMCwiMSJdLFswLDFdLFsxLDJdLFsyLDNdLFszLDRdLFs0LDVdXQ==
\[\begin{tikzcd}
	1 & {\mathcal O_K^\star} & {K^\star} & {I_K} & {\mathrm{Cl}_K} & 1
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-2, to=1-3]
	\arrow[from=1-3, to=1-4]
	\arrow[from=1-4, to=1-5]
	\arrow[from=1-5, to=1-6]
\end{tikzcd}\]
We can now state the main theorems of the course, which are:
\begin{enumerate}
    \item the class group is finite;
    \item \( \mathcal O_K^\star \) is the direct product of the roots of unity in \( K \) with \( \mathbb Z^{r+s-1} \).
\end{enumerate}
\begin{example}
    \( (3,1+2\sqrt{5})(3,1-2\sqrt{5}) = (3) \), so \( (3,1+2\sqrt{5}) \) and \( (3,1-2\sqrt{5}) \) are inverse in the class group.
\end{example}
\begin{example}
   Let  \( [L:\mathbb Q] = 2 \), so \( L = \mathbb Q(\sqrt{d}) \) for \( d \in \mathbb Z \), and \( d \not\equiv 1 \) mod 4.
   Let \( \mathfrak a \trianglelefteq \mathcal O_L \), so \( \mathfrak a \simeq \mathbb Z^2 \) giving \( \mathfrak a = \genset{\alpha, \beta} \) as an \( \mathcal O_L \)-module.
   We can always assume \( \beta \in \mathbb Z \).
   Indeed, write \( \alpha = a + b \sqrt{d} \) and \( \beta = a' + b' \sqrt{d} \).
   Let \( \ell = \gcd(b, b') = mb + m'b' \) where \( m, m' \in \mathbb Z \).
   Then let
   \[ \beta' = (m\alpha + m'\beta) \underbrace{\qty(\frac{-b'}{\ell})}_{\in \mathbb Z} + \beta \in \mathbb Z \]
   Then \( \genset{\alpha, \beta} = \genset{\alpha, \beta'} \).
    Alternatively, \( \mathcal O_L \cap \mathbb Z \neq \qty{0} \), and we can extend a minimal such set to a basis of \( \mathcal O_L \).
\end{example}
\begin{example}
    In a quadratic field \( \mathfrak a = \genset{\alpha, b} \) where \( b \in \mathbb Z \).
    Then \( \genset{b, \alpha} \genset{b, \overline \alpha} \) is principal.
    \[ \mathfrak a \overline{\mathfrak a} = \genset{b^2, b\alpha, b\overline \alpha, \alpha\overline\alpha} = \genset{b^2, b\alpha, b\underbrace{(\alpha + \overline \alpha)}_{\Tr(\alpha)}, N(\alpha)} = \genset{b\alpha, c} \]
    where \( c = \gcd(b^2, \Tr(\alpha), N(\alpha)) \).
    Let \( x = \frac{b\alpha}{c} \in L^\star \).
    \( \Tr(x) = \frac{b\Tr(\alpha)}{c} \in \mathbb Z \), and \( N(c) = N\qty(\frac{b\alpha}{c}) = \frac{b^2 N(\alpha)}{c^2} = \frac{b^2}{c} \frac{N(\alpha)}{c} \in \mathbb Z \), so \( x \in \mathcal O_L \), giving \( c \mid b\alpha \), so \( \mathfrak a \overline{\mathfrak a} = \genset{c} \).
    In particular, \( \genset{b, \alpha}, \genset{b, \overline \alpha} \) are inverse in the class group.
\end{example}

\subsection{Norms of ideals}
\begin{definition}
    Let \( L \) be a number field, and let \( [L:\mathbb Q] = n \).
    Let \( \mathfrak a \trianglelefteq \mathcal O_L \) be a nonzero ideal.
    The \emph{norm} of \( \mathfrak a \) is \( \abs{\faktor{\mathcal O_L}{\mathfrak a}} \).        
\end{definition}
By Lagrange's theorem, \( N(\mathfrak a) \cdot 1 = 0 \) in \( \faktor{\mathcal O_L}{\mathfrak a} \).
Hence \( N(\mathfrak a) \in \mathfrak a \cap \mathbb Z \).
\begin{example}
    Let \( p \) be a prime.
    \( N((p)) = \abs{\faktor{\mathbb Z^n}{\qty(p\mathbb Z)^n}} = p^n \).
\end{example}
\begin{proposition}
    Let \( \mathfrak a, \mathfrak b \trianglelefteq \mathcal O_L \) be nonzero ideals.
    Then, \( N(\mathfrak a \mathfrak b) = N(\mathfrak a) N(\mathfrak b) \).
\end{proposition}
\begin{remark}
    By unique factorisation of ideals, it suffices to show that \( N(\mathfrak p_1^{a_1} \dots \mathfrak p_n^{a_n}) = N(\mathfrak p_1)^{a_1} \dots N(\mathfrak p_n)^{a_n} \) for \( \mathfrak p_i \) distinct prime ideals.
    To show this, we need that
    \begin{enumerate}
        \item \( \faktor{\mathcal O_L}{\mathfrak p_1^{a_1} \dots \mathfrak p_n^{a_n}} \simeq \faktor{\mathcal O_L}{\mathfrak p_1^{a_1}} \dots \faktor{\mathcal O_L}{\mathfrak p_n^{a_n}} \) by the Chinese remainder theorem.
        \item \( \abs{\faktor{\mathcal O_L}{\mathfrak p^e}} = \abs{\faktor{\mathcal O_L}{\mathfrak p}} \cdot \abs{\faktor{\mathfrak p}{\mathfrak p^2}} \cdots \abs{\faktor{\mathfrak p^{e-1}}{\mathfrak p^e}} \) which is a general fact, and this is equal to \( \abs{\faktor{\mathcal O_L}{\mathfrak p}}^e \) as \( \faktor{\mathfrak p^a}{\mathfrak p^{a+1}} \) is a one-dimensional vector space over the field \( \faktor{\mathcal O_L}{\mathfrak p} \).
        This fact is specific to number fields (or more generally, Dedekind domains).
        For a counterexample, consider \( \mathbb F_p[X,Y] \) and \( \mathfrak p = (x,y) \).
    \end{enumerate}
\end{remark}
The following proof uses the above approach obscurely but quickly.
\begin{proof}
    By unique factorisation it suffices to show the result for \( \mathfrak b = \mathfrak p \) where \( \mathfrak p \) is prime.
    \( \mathfrak a \neq \mathfrak a \mathfrak p \) by unique factorisation, so let \( \alpha \in \mathfrak a \setminus \mathfrak a \mathfrak p \).
    We claim that the homomorphism of abelian groups \( \faktor{\mathcal O_L}{\mathfrak p} \to \faktor{\mathfrak a}{\mathfrak a \mathfrak p} \) mapping \( x \mapsto \alpha x \) is an isomorphism.
    Then,
    \[ \faktor{\mathcal O_L}{\mathfrak a} \simeq \faktor{\qty(\faktor{\mathcal O_L}{\mathfrak a \mathfrak p})}{\qty(\faktor{\mathfrak a}{\mathfrak a\mathfrak p})} \]
    so
    \[ N(\alpha) = \abs{\faktor{\mathcal O_L}{\mathfrak a}} = \frac{N(\alpha\mathfrak p)}{\abs{\faktor{\mathfrak a}{\mathfrak a \mathfrak p}}} \]
    but \( \abs{\faktor{\mathfrak a}{\mathfrak a \mathfrak p}} = \abs{\faktor{\mathcal O_L}{\mathfrak p}} = N(\mathfrak p) \) by the claim, proving the proposition.
    We now prove the claim.

    We show the homomorphism is injective.
    \( (\alpha) \subseteq \mathfrak a \) so \( (\alpha) = \mathfrak a \mathfrak c \) for some \( \mathfrak c \triangleleft \mathcal O_L \).
    Suppose \( x \) has \( \alpha x \in \mathfrak a \mathfrak p \), so \( x + \mathfrak p \) is in the kernel.
    Then, \( x \mathfrak a \mathfrak c \subseteq \mathfrak a \mathfrak p \).
    Dividing by \( \mathfrak a \), \( x\mathfrak c \subseteq \mathfrak p \).
    But \( \mathfrak p \) is prime, so \( x \in p \) or \( \mathfrak c \subseteq \mathfrak p \).
    But \( \mathfrak c \subseteq \mathfrak p \) implies \( \alpha \in \mathfrak a \mathfrak p \), contradicting our choice of \( \alpha \).
    So \( x \in \mathfrak p \), so the map is injective as required.

    We show the homomorphism is surjective.
    We want to show \( (\alpha) + \mathfrak a \mathfrak p = \mathfrak a \).
    We know that \( \mathfrak a \mathfrak p \subsetneq (\alpha) + \mathfrak a \mathfrak p \subseteq \mathfrak a \).
    Multiplying by \( \mathfrak a^{-1} \), we obtain
    \[ \mathfrak p \subsetneq ((\alpha) + \mathfrak a \mathfrak p) \mathfrak a^{-1} \subseteq \mathcal O_L \]
    But \( \mathfrak p \) is a prime and hence maximal.
    Therefore, \( ((\alpha) + \mathfrak a \mathfrak p) \mathfrak a^{-1} = \mathcal O_L \), so \( (\alpha) + \mathfrak \mathfrak p = \mathfrak a \), so the map is surjective.
\end{proof}
\begin{lemma}
    Let \( M \subseteq \mathbb Z^n \) be a subgroup.
    Then \( M \subseteq \mathbb Z^r \) for some \( 0 \leq r \leq n \).
    Suppose further that \( r = n \).
    Let \( e_1, \dots, e_n \) be a basis of \( \mathbb Z^n \) and \( v_1, \dots, v_n \) be a basis of \( M \) over \( \mathbb Z \).
    Then, \( \abs{\faktor{\mathbb Z^n}{M}} = \det A \) where \( A = (a_{ij}) \) and \( v_j = \sum a_{ij} e_i \).
\end{lemma}
\begin{proof}
    We can choose a basis \( v_1, \dots, v_n \) of \( M \) such that \( A \) is upper triangular.
    Then, \( \abs{\det A} = \abs{a_{11} \dots a_{nn}} \). 
\end{proof}
\begin{lemma}
    Let \( \mathfrak a \triangleleft \mathcal O_L \) be a nonzero ideal, and \( n = [L : \mathbb Q] \).
    Then,
    \begin{enumerate}
        \item There exist \( \alpha_1, \dots, \alpha_n \in \mathfrak a \) such that \( \mathfrak a = \qty{\sum_{i=1}^n r_i \alpha_i \mid r_i \in \mathbb Z} \), and \( \alpha_1, \dots, \alpha_n \) are a basis of \( L / \mathbb Q \).
        \item For any such \( \alpha_1, \dots, \alpha_n \in \mathfrak a \), \( \Delta(\alpha_1, \dots, \alpha_n) = N(\mathfrak a)^2 D_L \) where \( D_L \) is the discriminant of \( L \), and where \( \Delta(\alpha_1, \dots, \alpha_n) = \det \Tr(\alpha_i \alpha_j) = \qty(\det (\sigma_i \alpha_j))^2 \).
    \end{enumerate}
\end{lemma}
\begin{proof}
    \emph{Part (i).}
    The result holds for \( \mathcal O_L \), and if \( d \in \mathfrak a \) is an integer, such as \( d = N(\mathfrak a) \), then \( d\mathcal O_L \subseteq \mathfrak a \subseteq \mathcal O_L \), so as abelian groups, \( (d\mathbb Z)^n \subseteq \mathfrak a \subseteq \mathbb Z^n \), so \( \mathfrak a \simeq \mathbb Z^n \).

    \emph{Part (ii).}
    Let \( \alpha_1', \dots, \alpha_n' \) be an integral basis of \( \mathcal O_L \).
    Let \( A \) be the change of basis matrix from \( \alpha_1, \dots, \alpha_n \) to \( \alpha_1', \dots, \alpha_n' \).
    Then \( \Delta(\alpha_1, \dots, \alpha_n) = (\det A)^2 \Delta(\alpha_1', \dots, \alpha_n') = \abs{\faktor{\mathcal O_L}{\mathfrak a}}^2 D_L \) by the lemma.
\end{proof}
\begin{corollary}
    If \( \alpha_1, \dots, \alpha_n \) generating \( \mathfrak a \) as a \( \mathbb Z \)-module has \( \Delta(\alpha_1, \dots, \alpha_n) \) square-free, then \( \mathfrak a = \mathcal O_L \) and \( D_L \) is square-free.
    In particular, if \( L = \mathbb Q(\alpha) \) and \( \alpha \in \mathcal O_L \) where \( \mathrm{disc}(\alpha) = \Delta(1, \alpha, \dots, \alpha^{n-1}) \) is square-free, then \( \mathbb Z[\alpha] = \mathcal O_L \).
    More generally, if \( \alpha \in \mathcal O_L \) and \( L = \mathbb Q(\alpha) \), and \( d \in \mathbb Z \) is a maximal integer such that \( d^2 \mid \mathrm{disc}(\alpha) \), then \( \mathbb Z[\alpha] \subseteq \mathcal O_L \subseteq \frac{1}{d} \mathbb Z[\alpha] \).
\end{corollary}
